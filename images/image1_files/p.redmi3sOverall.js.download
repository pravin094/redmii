function modalPlayVideo(e,t){var i=e.attr("data-video"),a=e.attr("data-video-title");if(i){var o="<iframe frameborder='0' allowfullscreen width='854' height='480' src='"+i+"' type='application/x-shockwave-flash' quality='high' align='middle'/></iframe>";return t.addClass("modal-video"),t.find(".modal-body").html(""),t.find(".modal-body").append(o),a&&t.find(".modal-header .title").text(a),t.modal("show").on("hidden",function(){t.removeClass("modal-video"),t.find(".modal-body").html(""),t.find(".modal-header .title").text("")}),!1}}function easeInQuad(e){return e*e}function runScripts(e,t){t>=e.length||setTimeout(function(){e[t].callback(),runScripts(e,t+1)},e[t].pause)}function initCamera(e){var t=e.find(".stage"),i=e.find(".figure-border"),a=e.find(".figure-product"),o=e.find(".bg"),n=e.find(".content"),r=[{pause:500,callback:function(){o.addClass("bg-blur")}},{pause:800,callback:function(){i.addClass("is-visible")}},{pause:1e3,callback:function(){i.addClass("is-flash")}},{pause:600,callback:function(){t.addClass("is-active"),a.addClass("is-visible"),i.removeClass("is-visible is-flash"),n.addClass("is-visible")}}];e.data("init",!0),runScripts(r,0)}function initMIUI(e){var t=$(".section-screen"),i=[{pause:500,callback:function(){t.addClass("is-finish"),e.addClass("is-active")}},{pause:1500,callback:function(){e.addClass("is-finish")}}];e.data("init",!0),runScripts(i,0)}function refreshSummaryStage(e){function t(){r.each(function(){var e=$(this),t=$.parseJSON(e.attr("data-scroll-animation").replace(/'/g,'"'));e.css({transform:"translate3d("+t.x*easeInQuad(a)+"px,"+t.y*easeInQuad(a)+"px, 0)"})})}function i(e,i){a=e/i,0>=a?n.css({position:"absolute",top:0}):a>=1?n.css({position:"absolute",top:i}):n.css({position:"fixed",top:0}),t()}var a,o=$(".section-summary"),n=o.find(".J_summaryStage"),r=n.find("[data-scroll-animation]"),s=o.height()-winConfig.height+1200,c=[o.offset().top,o.offset().top+s];return supportTransitions?void(e<c[0]?i(0,s):e>c[1]?i(s,s):i(e-c[0],s)):(n.addClass("stage-static"),!1)}function resizeIntroHeight(){$(".section-intro").css("height",winConfig.height>900?winConfig.height:900)}function layerSlider(e,t){function i(e){l!==e&&(c.onSlideBefore(a.eq(l),l,e),a.css({display:"none",zIndex:-1},-1),a.eq(l).removeClass("active").css({display:"block",zIndex:1}),a.eq(e).addClass("active").css({display:"block",zIndex:2}),n.find("li").removeClass("active").eq(e).addClass("active"),c.onSlideAfter(a.eq(e),l,e),l=e)}var a,o,n,r,s,c,l=null;if(!(e.length<1)){if(e.length>1)return void e.each(function(){layerSlider($(this),t)});s={slideSelector:"> li",pagerSelector:"",startSlide:0,onSlideAfter:$.noop},c=$.extend({},s,t),e.wrap('<div class="slider-container"></div>'),a=e.find(c.slideSelector),o=e.parent(".slider-container"),n=$(c.pagerSelector),r=$('<div class="xm-controls xm-controls-middle"><a class="control control-prev iconfont" href="javascript: void(0);">&#xe908;</a><a class="control control-next iconfont" href="javascript: void(0);">&#xe90d;</a></div>'),o.css({position:"relative",overflow:"hidden"}).append(r),a.css({position:"absolute",top:0,left:0,zIndex:-1}),i(c.startSlide),r.find(".control-prev").on("click",function(e){e.preventDefault(),i(0===l?a.length-1:l-1)}),r.find(".control-next").on("click",function(e){e.preventDefault(),i(l===a.length-1?0:l+1)}),n.find("li").on("click",function(e){e.preventDefault(),i(n.find("li").index($(this)))})}}!function(e){function t(t){function i(){for(var t=-1,i=e(document).scrollTop(),a=0,o=l.length;o>a&&i+r.viewport.height()>l[a];a+=1)t+=1;return t}function a(){var t=i();c!==t&&(c=t,s.filter(function(t){return c>=t&&!e(this).hasClass(r.visibleClass)}).addClass(r.visibleClass).trigger("visible.visibleWatcher"),r.onVisible(s.eq(c),c))}function o(){s.each(function(){var t=e(this).attr("data-offset")?Number(e(this).attr("data-offset")):r.offset,i=t%1===0?t:t*r.viewport.height();l.push(e(this).offset().top+i)}),a(),r.onLoad()}var n,r,s=e(this),c=-1,l=[];n={viewport:e(window),visibleClass:"is-visible",offset:300,onLoad:e.noop,onVisible:e.noop},r=e.extend({},n,t),o(),r.viewport.on({"scroll.visibleWatcher":a,"resize.visibleWatcher":o})}e.fn.visibleWatcher=function(e){return t.call(this,e),this}}(jQuery),function(e){function t(i,a){function o(t){r=t.find(d.tabSelector),r.on(d.events,function(i){var a=r.index(e(this));if(i.preventDefault(),e(this).attr("href")&&e(this).attr("href").split("#")[1]){var o=e(window).scrollTop();window.location.hash=e(this).attr("href").split("#")[1],e("body, html").scrollTop(o)}n.each(function(){e(this).find(d.tabSelector).eq(a).addClass("tab-active").siblings(d.tabSelector).removeClass("tab-active")}),"function"==typeof d.onShow?d.onShow(c.eq(a),a):c.eq(a).removeClass("hide").show(),"function"==typeof d.onHide?d.onHide(c.eq(a).siblings(d.contentSelector),a):c.eq(a).siblings(d.contentSelector).addClass("hide").hide(),d.onLoad(t,a,d)})}var n,r,s,c,l,d;if(l={isSync:!1,events:"click",tabSelector:"li",containerSelector:".tab-container",contentSelector:".tab-content",onShow:null,onHide:null,onLoad:e.noop},d=e.extend({},l,a),d.isSync===!1){if(0===i.length)return i;if(i.length>1)return i.each(function(){t(e(this),a)}),i}n=e(i),s=n.first().attr("data-tab-target")?e("#"+n.first().attr("data-tab-target")):n.first().siblings(d.containerSelector),c=s.children(d.contentSelector),n.each(function(){o(e(this))}),d.onLoad(n,d)}e.fn.tabSwitch=function(e){return t(this,e),this}}(jQuery),function(e){function t(t){function i(){for(var t=-1,i=e(document).scrollTop(),a=0,o=l.length;o>a&&i+r.viewport.height()>l[a];a+=1)t+=1;return t}function a(){var t=i();c!==t&&(c=t,s.filter(function(t){return c>=t&&!e(this).hasClass(r.visibleClass)}).addClass(r.visibleClass).trigger("visible.visibleWatcher"),r.onVisible(s.eq(c),c))}function o(){s.each(function(){var t=e(this).attr("data-offset")?Number(e(this).attr("data-offset")):r.offset,i=t%1===0?t:t*r.viewport.height();l.push(e(this).offset().top+i)}),a(),r.onLoad()}var n,r,s=e(this),c=-1,l=[];n={viewport:e(window),visibleClass:"is-visible",offset:300,onLoad:e.noop,onVisible:e.noop},r=e.extend({},n,t),o(),r.viewport.on({"scroll.visibleWatcher":a,"resize.visibleWatcher":o})}e.fn.visibleWatcher=function(e){return t.call(this,e),this}}(jQuery),function(){function e(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function t(e,i,a){return("string"==typeof i?i:i.toString()).replace(e.define||r,function(t,i,o,n){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in a||(":"===o?(e.defineParams&&n.replace(e.defineParams,function(e,t,o){a[i]={arg:t,text:o}}),i in a||(a[i]=n)):new Function("def","def['"+i+"']="+n)(a)),""}).replace(e.use||r,function(i,o){e.useParams&&(o=o.replace(e.useParams,function(e,t,i,o){if(a[i]&&a[i].arg&&o){var n=(i+":"+o).replace(/'|\\/g,"_");return a.__exp=a.__exp||{},a.__exp[n]=a[i].text.replace(new RegExp("(^|[^\\w$])"+a[i].arg+"([^\\w$])","g"),"$1"+o+"$2"),t+"def.__exp['"+n+"']"}}));var n=new Function("def","return "+o)(a);return n?t(e,n,a):n})}function i(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var a,o={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define("source/js/themes/pandora/_plugins/doT.js",[],function(){return o}):(a=function(){return this||(0,eval)("this")}(),a.doT=o),String.prototype.encodeHTML=e();var n={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},r=/$^/;o.template=function(a,s,c){s=s||o.templateSettings;var l,d,u=s.append?n.append:n.split,f=0,p=s.use||s.define?t(s,a,c||{}):a;p=("var out='"+(s.strip?p.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):p).replace(/'|\\/g,"\\$&").replace(s.interpolate||r,function(e,t){return u.start+i(t)+u.end}).replace(s.encode||r,function(e,t){return l=!0,u.start+i(t)+u.endencode}).replace(s.conditional||r,function(e,t,a){return t?a?"';}else if("+i(a)+"){out+='":"';}else{out+='":a?"';if("+i(a)+"){out+='":"';}out+='"}).replace(s.iterate||r,function(e,t,a,o){return t?(f+=1,d=o||"i"+f,t=i(t),"';var arr"+f+"="+t+";if(arr"+f+"){var "+a+","+d+"=-1,l"+f+"=arr"+f+".length-1;while("+d+"<l"+f+"){"+a+"=arr"+f+"["+d+"+=1];out+='"):"';} } out+='"}).replace(s.evaluate||r,function(e,t){return"';"+i(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),l&&s.selfcontained&&(p="String.prototype.encodeHTML=("+e.toString()+"());"+p);try{return new Function(s.varname,p)}catch(h){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+p),h}},o.compile=function(e,t){return o.template(e,null,t)}}(),Xiaomi.warehouse={DOM:{wrapper:".J_warehouseCheck",pinInput:".J_xmPinInput",pinCheckBtn:".J_xmPinBtn",pinWarning:".J_pincodeWarning",changePinBtn:".J_xmPinChange",cityName:".J_cityName",checkProcess:".J_checkProcess",checkResult:".J_checkResult"},COOKIE:{stateId:"WH_stateId",cityName:"WH_cityName",warehouseId:"WH_warehouse"},init:function(){var e=this;e.autoWrite(),e.warehouseCheck()},warehouseCheck:function(){var e=this,t=e.DOM,i=t.wrapper+" "+t.pinInput,a=t.wrapper+" "+t.pinCheckBtn,o=t.wrapper+" "+t.pinWarning,n=t.wrapper+" "+t.changePinBtn;$(document).on("input",i,function(){$(i).val().length>5?$(a).removeAttr("disabled"):$(a).attr("disabled","")}),$(document).on("click",a,function(){if(!$(a).attr("disabled")){var t=$(i).val(),n=/^\d{6}$/;n.test(t)?($(o).fadeOut(50),e.queryPincodeInfo(t)):($(o).fadeIn(50),setTimeout(function(){$(o).fadeOut(50)},2e3))}}),$(document).on("click",n,function(t){$(this).parents(e.DOM.wrapper).find(e.DOM.checkResult).addClass("hide"),$(this).parents(e.DOM.wrapper).find(e.DOM.checkProcess).removeClass("hide")})},queryPincodeInfo:function(e){var t=this,i=GLOBAL_CONFIG.orderSite+"/address/zipcodecheck?zipcode="+e;Xiaomi.utils.jsonp({url:i,jsonpCallback:"getPinInfo",success:function(i){var a="",o="",n="";if(0===parseInt(i.code)){a=i.data.parent_id,o=i.data.citys,n=i.data.warehouse;var r={pin:e,stateId:a,cityName:o,warehouseId:n,reload:!0,callback:""};$(".J_cartDeliver").length>0&&(r.reload=!1,r.callback=t.updateCart),t.writePinCheckResult(r)}else alert(i.message)}})},writePinCheckResult:function(e){var t=Xiaomi.warehouse,i=t.DOM.wrapper+" "+t.DOM.cityName,a=Xiaomi.utils.cookie(t.COOKIE.stateId),o=Xiaomi.utils.cookie(t.COOKIE.cityName),n=Xiaomi.utils.cookie(t.COOKIE.warehouseId);e.cityName&&e.stateId&&($(i).text(""+e.cityName).attr(t.COOKIE.stateId,e.stateId),$(t.DOM.wrapper).find(t.DOM.checkProcess).addClass("hide"),$(t.DOM.wrapper).find(t.DOM.checkResult).removeClass("hide"),(o!=e.cityName||a!=e.stateId)&&(e.pin&&Xiaomi.utils.cookie("XM_pincode_"+GLOBAL_CONFIG.appLocal.name,e.pin,{expires:365,path:"/"+GLOBAL_CONFIG.appLocal.name,domain:".mi.com"}),Xiaomi.utils.cookie(t.COOKIE.stateId,e.stateId,{expires:365,path:"/"+GLOBAL_CONFIG.appLocal.name,domain:".mi.com"}),Xiaomi.utils.cookie(t.COOKIE.cityName,e.cityName,{expires:365,path:"/"+GLOBAL_CONFIG.appLocal.name,domain:".mi.com"}),n!=e.warehouseId&&(Xiaomi.utils.cookie(t.COOKIE.warehouseId,e.warehouseId,{expires:365,path:"/"+GLOBAL_CONFIG.appLocal.name,domain:".mi.com"}),e.callback&&e.callback(),e.reload&&window.location.reload())))},updateCart:function(){var e=Xiaomi.warehouse,t=Xiaomi.utils.cookie(e.COOKIE.stateId);$.getJSON(GLOBAL_CONFIG.orderSite+"/cart?ajax=shopCarBox&WH_stateId="+t,function(t){$(".J_cartBox").html(t.html),e.autoWrite()})},autoWrite:function(){var e=this,t=Xiaomi.utils.cookie(e.COOKIE.stateId),i=Xiaomi.utils.cookie(e.COOKIE.cityName),a=Xiaomi.utils.cookie(e.COOKIE.warehouseId);t&&i&&e.writePinCheckResult({stateId:t,cityName:i,warehouseId:a})},addAjaxParam:function(e){var t=Xiaomi.warehouse,i=Xiaomi.utils.cookie(t.COOKIE.stateId),a=Xiaomi.utils.cookie(t.COOKIE.cityName);return i&&a&&(e+="?WH_stateId="+i),e}},$(document).ready(function(){Xiaomi.warehouse.init()}),function(){var e={};Xiaomi.prototype.buyWay=function(t,i){function a(e){this.outOfStock=function(t){e.enableClass("J_openNotifyPop",i.text.notify),e.attr("data-gid",t)},this.bespeak=function(){e.enableUrl(i.bespeakUrl,i.text.bespeak)},this.bespeakBuy=function(t){e.enableUrl(i.bespeakUrl,i.text.buy)},this.addToCart=function(t){e.enableUrl(xiaomi.globalConfig.orderSite+"/cart/add/"+t,i.text.buy)},this.selectPacket=function(t){e.enableUrl(xiaomi.globalConfig.orderSite+"/event/selectPacket/goodsId/"+t,i.text.buy)},this.presale=function(t){e.enableClass("J_openPresalePop",i.text.buy),$(".J_presalePop").attr("data-gid",t)},this.colorChoose=function(t){e.enableClass("J_openColorPop",t)},this.beforeFlashSale=function(){e.enableUrl(i.bespeakUrl,i.text.beforeFlashSale)},this.damiao=function(t,a,o){e.enableUrl("#",i.text.buy).on("click.buy",function(){xiaomi.cart().addGood(t,function(){o?window.location.href=xiaomi.globalConfig.orderSite+"/cart/recommend?phone="+i.productType+"&goodsId="+t:window.location.href=xiaomi.globalConfig.orderSite+"/cart"})})},this.switchStatusCode=function(e){var t=this,i=e.status;switch(i){case 2:t.bespeak();break;case 3:case 13:t.beforeFlashSale();break;case 4:case 14:e.is_cos?t.outOfStock(e.id):t.bespeakBuy()}}}function o(e){var t=[2,3,4,13,14];return-1!==$.inArray(e,t)?!0:!1}function n(e,t){if(t&&t.length>0){for(var a=0,n=!0,r=!1,s=!1,c=!1,l=!1,d=[],u=null,f=0;f<t.length;f++){var p=!1;t[f].needSubscribe&&(s=!0),t[f].is_presale&&!t[f].presale_cos&&(r=!0),o(t[f].status)&&(c=!0,a++,1==a&&(d=t[f]),p||t[f].is_cos||(u=t[f],p=!0)),t[f].is_cos||(n=!1,o(t[f].status)||(l=!0))}return a==t.length?void(u?e.switchStatusCode(u):e.switchStatusCode(d)):t.length>1?void(n&&!r?e.colorChoose(i.text.notify):e.colorChoose(i.text.buy)):t[0].is_presale&&!t[0].presale_cos?void e.presale(t[0].id):t[0].is_cos&&0==a?void(s?e.bespeak():e.outOfStock(t[0].id)):t[0].needSubscribe?void e.bespeakBuy():t[0].is_bigtap?(-1==$.inArray(parseInt(t[0].id),xiaomi.globalConfig.damiaoGoodsId)&&xiaomi.globalConfig.damiaoGoodsId.push(parseInt(t[0].id)),void e.damiao(t[0].id,t[0].has_packet,t[0].has_recommend)):void e.addToCart(t[0].id)}e.outOfStock(t[0].id)}function r(e){var t=[];if(!(e.length<=0)){for(var i=0;i<e.length;i++){var a={id:e[i].sku,name:e[i].name,price:e[i].price};t.push(a)}dataLayer.push({ecommerce:{detail:{actionField:{list:"Arraytitle"},products:t}}})}}function s(e){function t(e,t){!t&&(t=",");var i=e.toString().split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,t),i.join(".")}function i(e){var a=e.length,o=e[0].price,n=e[0].market_price,r='<span class="xm-dollor-sign">'+e[0].currency+" </span>",s='<span class="xm-from">From </span>',c="";if(a>1){for(var l=[],d=0;d<e.length;d++)-1==$.inArray(e[d].price,l)&&l.push(e[d].price);return l=l.sort(function(e,t){return e-t}),l.length>1?c=s+r+'<span class="xm-price">'+t(l[0])+"</span>":i([e[0]])}return c+=r+'<span class="xm-price">'+t(o)+"</span>",o!=n&&(c+=' <span class="xm-ori-price"><del>'+r+t(n)+"</del></span>"),c}function a(){!e||e.length<=0||h.each(function(t,a){var o=$(a),n=e;if(o.attr("data-gids")){for(var r=o.attr("data-gids").split(","),s=[],c=0;c<r.length;c++){var l=$.grep(e,function(e){return e.id==r[c]});s.push(l[0])}s.length>0&&(n=s)}o.addClass("xm-pro-price").html(i(n))})}a()}function c(t){$(document).on("click",".J_openPresalePop",function(e){e.preventDefault();var t=$(e.target).parents(".modal");t.modal("hide");var i=$(".J_presalePop");i.modal("show")}),$(document).on("click",".J_openColorPop",function(e){e.preventDefault();var i=$(".J_colorPop");if(i.modal("show"),!i.html()){var a=doT.template($("#colorPopTempl").html()),o=a(t);i.html(o),i.find(".J_proList>li").eq(0).click(),Xiaomi.warehouse.autoWrite()}}),$(document).on("click",".J_colorPop .J_proList>li",function(e){var i=$(this).attr("data-img"),o=$(this).attr("data-price"),r=$(this).attr("data-name"),s=$(this).attr("data-title"),c=$(this).attr("data-product"),l=$(this).attr("data-gid"),d=$(this).parents(".J_colorPop"),f=d.find(".J_popTitle"),p=new a(d.find(".J_btnYes").buyButton()),h=$.grep(t,function(e){return e.id===l});d.find(".J_proThumb").attr({src:i+"?width=220&height=220",alt:s}),d.find(".J_proName").text(r),d.find(".J_proPrice").text(o),c!==f.text()&&f.text(c),$(this).addClass("selected").siblings().removeClass("selected out-of-stock"),d.find(".J_proInfo").show(),d.find(".J_proStock").hide(),d.find(".J_proRegister").hide(),d.find(".J_soldBy")&&d.find(".J_soldBy").text("Sold by : "+h[0].goods_dealer),n(p,h),u(h[0])&&d.find(".J_proRegister").text(u(h[0])).show(),!h[0].is_cos||h[0].is_presale&&!h[0].presale_cos||($(this).addClass("out-of-stock"),d.find(".J_proInfo").hide(),d.find(".J_proRegister").hide(),d.find(".J_proStock").show())}),$(document).on("click",".J_colorPop .J_btnYes",function(e){var t=$(this).parents(".J_colorPop");t.modal("hide")}),$(document).on("click",".J_openNotifyPop",function(t){var i=$(".J_notifyPop"),a=i.find(".notifyStep");i.attr("data-gid",$(this).attr("data-gid"));var o=xiaomi.globalConfig.orderSite+"/arrivalnotice/watch",n=i.attr("data-gid");$(this).attr("disabled")||(Xiaomi.utils.cookie("userId")?e[n]?(i.modal("show"),a.addClass("hide").filter('[data-type="confirm"]').removeClass("hide")):n&&(o=o+"?goodsId="+n,Xiaomi.utils.jsonp({url:o,jsonpCallback:"arrivalnotice",successcallback:function(t){i.modal("show"),a.addClass("hide").filter('[data-type="confirm"]').removeClass("hide"),e[n]=!0},errorcallback:function(e){alert(e.errmsg)}})):Xiaomi.utils.login())}),f(".J_presalePop .modal-footer .J_agree",function(e){var t=e.parents(".J_presalePop"),i=t.find(".modal-footer .J_btnYes"),o=t.attr("data-gid"),n=new a(t.find(".J_btnYes").buyButton());i.removeAttr("disabled"),n.addToCart(o+"?source=presales")},function(e){var t=e.parents(".J_presalePop"),i=t.find(".modal-footer .J_btnYes");i.attr("disabled","").removeAttr("href")})}function l(e,t){var i=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(i,function(e){return t[e.toLowerCase()]})}function d(e){var t,a=new Date(e),o=a.getDate(),n=i.dateFormat.monthArray[a.getMonth()],r=a.getHours();r>12?(r-=12,t=i.dateFormat.pm):t=12==r?i.dateFormat.noon:i.dateFormat.am,0==r&&(r=12);var s=[o,n,r,t];return s}function u(e){var t=d(1e3*e.pb_start),a={"%d":t[0],"%m":t[1],"%h":t[2],"%n":t[3]},o=l(i.remarkText.register,a),n=l(i.remarkText.registerOver,a),r=l(i.remarkText.saleAt,a);switch(e.status){case 2:return o;case 3:return n;case 4:return n;case 13:return r;case 14:return r;default:return}}function f(e,t,i){var a=this;return this.disable=function(e,t){return e.removeAttr("checked"),null!==t&&"function"==typeof t&&t(e),this},this.enable=function(e,t){return e.attr("checked",""),null!==t&&"function"==typeof t&&t(e),this},$(document).on("click",e,function(e){$target=$(this),$target.hasClass("xm-checkbox")&&($(this).attr("checked")?a.disable($target,i):a.enable($target,t))}),this}var p={bespeakUrl:xiaomi.globalConfig.wwwSite+"/hdindex/openbuy/",text:{outOfStock:"Out of Stock",buy:"Buy now",bespeak:"Register",beforeFlashSale:"Coming Soon",init:"Buy now",notify:"Notify me"},dateFormat:{monthArray:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],am:"am",noon:"noon",pm:"pm"},remarkText:{register:"Register for %d %m %h %n sale",registerOver:"Registration over. (Sale at %d %m %h %n )",saleAt:"Sale at %d %m %h %n"}};i=$.extend(!0,{},p,i),$.fn.buyButton=function(){return this.disable=function(e){return this.reset(),this.attr("disabled","").removeAttr("href").text(e),this},this.enableUrl=function(e,t){return this.reset(),this.removeAttr("disabled").attr("href",e).text(t),this},this.enableClass=function(e,t){return this.reset(),this.removeAttr("disabled").addClass(e).text(t),this},this.reset=function(){this.removeAttr("href data-gid").removeClass("J_openNotifyPop J_openPresalePop J_openColorPop").off("click.buy")},this};var h=$(".J_xmProPrice");if(t.length>0||h.length>0){var m=new a(t.buyButton()),v=xiaomi.globalConfig.orderSite+"/misc/getStarStock/hdid/"+i.productType;v=Xiaomi.warehouse.addAjaxParam(v),$.ajax({type:"get",url:v,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"getStarStock",success:function(e){$(".J_goodsDealer").length>0&&e[0]&&$(".J_goodsDealer").text("The "+$(".J_goodsDealer").attr("data-name")+" is sold in India by "+e[0].goods_dealer+", an authorized Indian distributor of Mi products."),h.length>0&&s(e),t.length>0&&(n(m,e),c(e)),"in"===GLOBAL_CONFIG.appLocal.name&&r(e)},errorcallback:function(e){alert(e.errmsg)}})}}}(),window.tarList=[];var tarList=window.tarList,scrollCallback=function(){var e=$(window).scrollTop();for(var t in tarList)if(tarList.hasOwnProperty(t)){var i=tarList[t],a=i.top;e>a?i.callback(i,e):i.reverse&&i.reverse(i,e)}};$(window).on("scroll",function(){scrollCallback()});var supportsVideo=function(){return!!document.createElement("video").canPlayType}();window.supportsVideo=supportsVideo,$(function(){$("#J_modalVideo");$(".J_videoBtn").click(function(e){e.preventDefault(),modalPlayVideo($(this),$("#videowrap"))});var e=function(){var e=$(".J_bar").offset().top+$(".J_bar").height(),t=e;tarList.push({top:t,callback:function(){$(".J_fixNarBar").addClass("nav-bar-fixed")},reverse:function(){$(".J_fixNarBar").removeClass("nav-bar-fixed")}})};e(),$(".J_next").on({mouseenter:function(){if($(this).addClass("hover"),supportsVideo){var e=$(this).find("source").attr("data-src"),t=$(this).find("source").attr("src");void 0===t?($(this).find("source").attr("src",e),$(this).find("video").load()[0].play()):$(this).find("video")[0].play()}},mouseleave:function(){$(this).removeClass("hover")}})});var $sectionContainer=$(".J_visibleSectionContainer"),$sections=$sectionContainer.find("> .section"),preloadLength=1,supportsVideo=function(){return!!document.createElement("video").canPlayType}(),supportTransitions=function(){var e,t,i=document.body||document.documentElement,a=i.style,o="transition";if("string"==typeof a[o])return!0;for(e=["Moz","webkit","Webkit","Khtml","O","ms"],o=o.charAt(0).toUpperCase()+o.substr(1),t=0;t<e.length;t++)if("string"==typeof a[e[t]+o])return!0;return!1}(),winConfig={width:$(window).width(),height:$(window).height()};jQuery(function(e){var t=e(window),i=(e("body, html"),e(".J_demoSlider")),a=t.scrollTop(),o=e(".section-screen");supportTransitions&&$sections.addClass("support-transition"),resizeIntroHeight(),refreshSummaryStage(a),layerSlider(i,{pagerSelector:"#J_demoSliderTrigger",onSlideBefore:function(e){supportsVideo&&e.find(".video")[0].pause()},onSlideAfter:function(e){supportsVideo&&i.closest(".section").hasClass("is-visible")&&e.find(".video")[0].play()}}),$sections.visibleWatcher({onVisible:function(t,i){var a=t.find(".video").filter(function(){return e(this).data("autoplay")});$sections.filter(function(e){return i+preloadLength>=e}).addClass("preload").find(".video").attr("preload","auto"),t.hasClass("section-camera")&&!t.data("init")&&initCamera(t),t.hasClass("section-screen")&&e(".section-miui").data("init")&&o.removeClass("is-finish"),t.hasClass("section-miui")&&!t.data("init")&&initMIUI(t),supportsVideo&&a.length&&a.each(function(e){var t=a.eq(e);t.data("preload")||(t.data("preload",!0),t[0].play())})}}),e(".J_tabSwitch").tabSwitch(),t.on({scroll:function(){var t=e(window),i=t.scrollTop();refreshSummaryStage(i)},resize:function(){var t=e(window),i=t.scrollTop();winConfig.height=t.height(),resizeIntroHeight(),refreshSummaryStage(i)}})});